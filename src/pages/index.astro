---
import { getIndexById, getSlugFromId } from "@/utils";
import { META } from "@/consts";
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";
const collection = await getCollection("interviews");
const interviews = collection.sort((a, b) => {
  const aDate = a.data.published;
  const bDate = b.data.published;
  return Date.parse(aDate.toString()) - Date.parse(bDate.toString());
});
---

<Layout>
  <header class="mt-8 mb-12">
    <h1 class="font-bold text-4xl tracking-tight">{META.title}</h1>
    <p class="mt-1 text-2xl font-medium text-neutral-600 max-w-prose">
      {META.description}
    </p>
  </header>

  <section class="mb-12">
    <p class="font-mono text-neutral-600 text-sm">Join 14,000+ other readers</p>
    <form
      action="https://buttondown.com/api/emails/embed-subscribe/ibrewmyowncoffee"
      method="post"
      target="popupwindow"
      onsubmit="window.open('https://buttondown.com/ibrewmyowncoffee', 'popupwindow')"
      class="flex gap-4 mt-2 flex-col sm:flex-row"
    >
      <label for="bd-email" class="sr-only">Email address</label>
      <input
        type="email"
        name="email"
        id="bd-email"
        placeholder="you@example.com"
        required
        class="relative px-4 py-2 rounded-sm border border-neutral-300 sm:w-1/2 md:w-1/3"
      />
      <input
        type="submit"
        value="Subscribe for free"
        class="relative px-4 py-2 rounded-sm border border-neutral-950 bg-neutral-950 text-neutral-50 font-medium"
      />
    </form>
  </section>

  <ul>
    {
      [...interviews].reverse().map((interview, i) => {
        const slug = getSlugFromId(interview.id);
        const issue = getIndexById(interviews, interview.id);
        return (
          <li class="flex flex-col sm:flex-row gap-x-4 border-t border-dashed border-neutral-300 py-4">
            <figure class="aspect-video bg-neutral-100 sm:w-1/2 md:w-1/3 rounded-sm" />
            <div class="flex flex-col pt-4 sm:pb-4">
              <p class="text-neutral-600 font-mono uppercase text-xs mb-auto">
                // Issue {issue}
              </p>
              <p class="font-bold text-lg tracking-tight">
                <a
                  href={`/interviews/${slug}`}
                  class="underline decoration-[#DFFF1F]"
                >
                  {interview.data.title}
                </a>
              </p>
              <p class="text-neutral-600 font-mono text-sm">
                {interview.data.description}
              </p>
            </div>
          </li>
        );
      })
    }
  </ul>
</Layout>
