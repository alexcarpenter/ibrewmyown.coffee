---
import Layout from "@/layouts/Layout.astro";
import { getSlugFromId, getIndexById } from "@/utils";
import { type CollectionEntry, getCollection, render } from "astro:content";
export async function getStaticPaths() {
  const collection = await getCollection("interviews");
  const interviews = collection.sort((a, b) => {
    const aDate = a.data.published;
    const bDate = b.data.published;
    return Date.parse(aDate.toString()) - Date.parse(bDate.toString());
  });
  return interviews.map((interview) => {
    const id = getSlugFromId(interview.id);
    const issue = getIndexById(interviews, interview.id);
    return {
      params: { id },
      props: { ...interview, issue },
    };
  });
}
type Props = CollectionEntry<"interviews"> & {
  issue: string;
};
const interview = Astro.props;
const { Content } = await render(interview);
---

<Layout>
  <header class="mt-8">
    <p class="mb-1 text-neutral-600 font-mono uppercase text-xs">
      // Issue {interview.issue}
    </p>
    <h1 class="mb-1 font-bold text-4xl tracking-tight">
      {interview.data.title}
    </h1>
    <p class="text-2xl font-medium text-neutral-600 max-w-prose">
      {interview.data.description}
    </p>
  </header>
  <figure class="aspect-video bg-neutral-100 rounded-sm my-8"></figure>
  <div class="grid grid-cols-4 gap-x-4">
    <div class="col-span-3">
      <div class="prose">
        <Content />
      </div>
    </div>
    <div class="col-span-1">
      {
        interview.data.social ? (
          <dl
            class:list={[
              "[&_dt]:mt-2 [&_dt]:pt-2 [&_dt]:border-t [&_dt]:border-dashed [&_dt]:border-neutral-300 [&_dt]:font-mono [&_dt]:uppercase [&_dt]:text-xs [&_dt]:text-neutral-600",
              "[&_dd]:font-medium",
            ]}
          >
            {interview.data.social?.twitter ? (
              <>
                <dt>Twitter</dt>
                <dd>
                  <a
                    href={`https://x.com/${interview.data.social?.twitter}`}
                    target="_blank"
                    class="underline decoration-[#DFFF1F]"
                  >
                    @{interview.data.social?.twitter}
                  </a>
                </dd>
              </>
            ) : null}
            {interview.data.social?.instagram ? (
              <>
                <dt>Instagram</dt>
                <dd>
                  <a
                    href={`https://instagram.com/${interview.data.social?.instagram}`}
                    target="_blank"
                    class="underline decoration-[#DFFF1F]"
                  >
                    @{interview.data.social?.instagram}
                  </a>
                </dd>
              </>
            ) : null}
            {interview.data.social?.website ? (
              <>
                <dt>Website</dt>
                <dd>
                  <a
                    href={interview.data.social?.website}
                    target="_blank"
                    class="underline decoration-[#DFFF1F]"
                  >
                    {new URL(interview.data.social?.website).hostname}
                  </a>
                </dd>
              </>
            ) : null}
          </dl>
        ) : null
      }
    </div>
  </div>
</Layout>
