---
import { getIndexById, getSlugFromId, isProd } from "@/utils";
import { META } from "@/consts";
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
const collection = await getCollection("interviews", ({ data }) => {
  return isProd ? data.draft !== true : true;
});
const interviews = collection.sort((a, b) => {
  const aDate = a.data.published;
  const bDate = b.data.published;
  return Date.parse(bDate.toString()) - Date.parse(aDate.toString());
});
const latestInterview = interviews.slice(0, 1);
const restInterviews = interviews.slice(1, interviews.length);
---

<Layout>
  <header class="mt-8 relative overflow-hidden">
    <h1 class="font-bold text-3xl sm:text-4xl tracking-tight">
      {META.title}
    </h1>
    <p
      class="relative mt-1 text-xl sm:text-2xl font-medium text-muted-foreground"
    >
      {META.description}
    </p>
  </header>

  <section class="full-width mt-12 py-12 relative bg-muted">
    <div class="w-full max-w-5xl mx-auto px-4 relative">
      {
        latestInterview.map((interview) => {
          const slug = getSlugFromId(interview.id);
          const issue = getIndexById(interviews, interview.id);
          const thumbnail = interview.data.gallery?.at(0);
          return (
            <div class="flex flex-col sm:flex-row gap-x-4 relative">
              <figure class="relative overflow-hidden aspect-video sm:aspect-square lg:aspect-video bg-muted sm:w-1/2 md:w-1/3 shrink-0">
                {thumbnail ? (
                  <Image
                    src={thumbnail?.src}
                    alt={thumbnail.alt}
                    width="400"
                    height="225"
                    style={`--object-position:${thumbnail.position || "center"}`}
                    class="absolute h-full w-full object-cover object-[var(--object-position)]"
                  />
                ) : null}
              </figure>
              <div class="flex flex-col pt-4 sm:pb-4 relative">
                {/* <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 506.4895 363.7745"
                  class="w-16 absolute right-0 -top-4 sm:top-0 rotate-45"
                  aria-hidden="true"
                >
                  <polygon
                    points="241.8955 122.5959 267.6806 46.615 303.9984 106.546 373.6121 10.203 375.0701 81.061 493.9202 1.7485 408.4046 120.8202 505.0195 133.3555 407.7502 171.2103 481.5284 231.8253 372.9336 218.6766 422.9616 284.4541 314.7628 249.1148 307.2274 322.8156 252.0081 271.5434 217.3234 356.2644 183.0537 291.5849 104.679 362.5975 108.3106 287.8182 2.0634 304.5586 99.6661 230.1755 8.2721 167.0856 119.6724 178.9197 84.0355 107.9855 168.3987 138.1369 184.4425 70.7763 241.8955 122.5959"
                    stroke-miterlimit="10"
                    class="fill-foreground"
                  />
                  <path
                    d="m165.8291,235.9587c.542,5.0957,1.2715,10.7266,2.0303,14.9756.4141,2.3164.9795,4.4521,1.4609,6.6309.5156,2.3721,1.1182,5.2256,1.6006,7.9287.8975,5.0215.4238,11.1504-5.0762,13.9131-4.3164,2.168-6.626.5938-8.0742-7.5176-1.2764-7.1445-1.6221-14.7578-3.0537-22.7715-1.5-8.4004-3.085-16.7588-4.9258-25.5137-.4639-2.083-1.1836-4.5615-1.5801-6.7822-.6211-3.4766.8721-8.541,4.5107-10.3682,7.9551-3.9956,14.1133,8.7998,18.6367,13.4722,6.1074,7.3496,21.9971,20.937,25.2803,19.1821.2539-.127-.1787-3.0664-.835-6.7344-1.1895-6.6626-2.7852-13.0166-4.1787-19.7871-1.2559-5.9971-3.4814-13.2964-4.2236-17.4487-.7246-4.0557.918-10.3511,4.9795-12.3916,6.0928-3.0601,7.8457,4.688,9.0186,11.2534,1.1895,6.6621,1.9561,13.5376,3.2324,20.6821,1.6035,8.9805,3.8008,17.6616,5.5938,27.7036,1.2764,7.1445.1387,12.1367-5.9541,15.1963-7.3623,3.6982-28.9707-11.9648-38.4424-21.623Z"
                    stroke-width="0"
                    class="fill-accent"
                  />
                  <path
                    d="m249.8047,175.3678c-3.3848,1.7002-7.9053,3.2349-12.6445,5.6152-3.5537,1.7852-6.6006,3.3154-9.6953,5.606.0986,4.686.7227,9.2124,1.5332,13.7495.0869.4834.4248.313.9326.0581,4.6543-2.3374,14.0703-10.5396,18.3867-12.7075,3.8076-1.9126,7.6426-.5762,8.3838,3.5742.6211,3.4766-.3994,8.0928-4.1553,10.2949-7.3252,4.416-19.0957,13.3789-21.8037,14.7393.1064,1.6299.5557,4.1406,1.7969,11.0928.5,2.7998,2.583,2.0698,5.376.667,4.9922-2.5078,14.7637-10.7827,19.8418-13.333,4.1465-2.083,7.4199-1.3066,8.1953,3.0381.8105,4.5381-.9736,8.4854-4.7461,11.1162-8.9121,6.3711-15.7471,10.9609-23.4473,14.8291-9.7314,4.8877-14.3936,4.5986-16.8604-9.209-2.5693-14.3867-3.6396-31.7354-6.1748-45.9297-.8965-5.0205.3242-10.5791,4.7402-13.2183,9.0684-5.501,15.1924-9.4185,25.5166-14.604,4.7383-2.3804,11.2715-5.5576,12.6689,2.2637,1.1201,6.2764-2.2598,9.5527-7.8447,12.3574Z"
                    stroke-width="0"
                    class="fill-accent"
                  />
                  <path
                    d="m321.7041,201.0187c-5.416,2.7202-13.835-17.5679-16.4512-24.9878-1.0762-2.9302-2.0186-6.1392-2.2402-6.3447-.7236,1.627-2.2832,12.5107-3.6914,23.2139-1.3906,10.7988-2.667,20.1748-8.083,22.8945-2.2002,1.1055-4.3203.5908-6.4873-3.793-8.9033-18.3594-18.1357-38.5537-20.3262-50.8164-.793-4.4414,2.0762-8.5132,5.5449-10.2559,2.5391-1.2749,5.6074-1.1328,7.041,1.7256,3.6836,7.7236,7.0957,25.791,11.2695,32.6377,1.5254-5.3955,3.7148-15.8594,4.3252-26.8975.416-7.9951,1.0781-18.7441,7.001-21.7192,4.2314-2.125,7.3564-.1182,8.5605,5.5913,2.957,13.4546,6.9326,22.2949,11.2324,31.394,2.1211-10.3237,1.4824-19.5781,1.9004-32.73.1543-4.8125.4639-20.1196,7.3184-23.5625,3.5537-1.7852,7.0332-.376,7.7568,3.6797.5,2.7998-.9121,11.9277-1.5576,17.0918-1.9375,14.9668-.75,26.2598-3.2227,38.2334-1.8965,11.5801-3.46,21.4146-9.8906,24.645Z"
                    stroke-width="0"
                    class="fill-accent"
                  />
                  <path
                    d="m366.1474,128.1911c.6729,3.7656,3.8643,22.1533-2.3125,25.2559-6.0088,3.0186-7.9053-1.9229-9.4053-10.3232-1.9658-11.0068-2.5615-17.4414-4.5967-28.835-1.1377-6.3721-.6953-11.1191,5.3975-14.1797,4.6543-2.3379,6.582,1.7446,7.4443,6.5728,1.3965,7.8203,1.7832,12.0464,3.4727,21.5093Zm6.9785,37.0024c.8623,4.8281-2.168,11.6113-6.3994,13.7368-3.6387,1.8271-7.3916-.6016-8.1338-4.7539-.8965-5.0205,1.9473-11.8145,6.2627-13.9819s7.4941.6543,8.2705,4.999Z"
                    stroke-width="0"
                    class="fill-accent"
                  />
                </svg> */}
                <p class="text-muted-foreground font-mono uppercase text-xs mb-auto">
                  // Issue {issue}
                </p>
                <p class="font-bold text-xl tracking-tight my-1">
                  <a
                    href={`/interviews/${slug}`}
                    class="underline decoration-accent hover:bg-accent"
                  >
                    {interview.data.title}
                  </a>
                </p>
                <p class="text-muted-foreground font-mono text-sm text-balance">
                  {interview.data.description}
                </p>
              </div>
            </div>
          );
        })
      }
    </div>
  </section>

  <section class="mt-12">
    <h2 class="font-mono text-muted-foreground text-sm">
      Join the weekly newsletter
    </h2>
    <form
      action="https://buttondown.com/api/emails/embed-subscribe/ibrewmyowncoffee"
      method="post"
      target="popupwindow"
      onsubmit="window.open('https://buttondown.com/ibrewmyowncoffee', 'popupwindow')"
      class="flex gap-4 mt-2 flex-col sm:flex-row"
    >
      <label for="bd-email" class="sr-only">Email address</label>
      <input
        type="email"
        name="email"
        id="bd-email"
        placeholder="you@example.com"
        required
        class="relative px-4 py-2 border border-neutral-300 bg-white sm:w-1/2 md:w-1/3 shadow-sm shadow-black/5"
      />
      <input
        type="submit"
        value="Subscribe for free"
        class="relative px-4 py-2 border border-secondary bg-secondary text-secondary-foreground font-medium shadow-sm shadow-black/5 tracking-tight"
      />
    </form>
    <p
      class="mt-2 sm:w-1/2 md:w-1/3 text-[0.625rem] font-mono text-muted-foreground"
    >
      [WARNING]: Subscribing may inspire you to purchase new coffee gear.
      Proceed with caution.
    </p>
  </section>

  {
    restInterviews.length > 0 ? (
      <section class="mt-12">
        <h2 class="sr-only">Interviews</h2>
        <ul>
          {restInterviews.map((interview) => {
            const slug = getSlugFromId(interview.id);
            const issue = getIndexById(interviews, interview.id);
            const thumbnail = interview.data.gallery?.at(0);
            return (
              <li class="flex flex-col sm:flex-row gap-x-4 border-t border-dashed border-black/20 py-4 relative">
                <figure class="relative overflow-hidden aspect-video sm:aspect-square lg:aspect-video  bg-muted sm:w-1/2 md:w-1/3 shrink-0">
                  {thumbnail ? (
                    <Image
                      src={thumbnail?.src}
                      alt={thumbnail.alt}
                      width="400"
                      height="225"
                      style={`--object-position:${thumbnail.position || "center"}`}
                      class="absolute h-full w-full object-cover object-[var(--object-position)]"
                    />
                  ) : null}
                </figure>
                <div class="flex flex-col pt-4 sm:pb-4 relative">
                  <p class="text-muted-foreground font-mono uppercase text-xs mb-auto">
                    // Issue {issue}
                  </p>
                  <p class="font-bold text-xl tracking-tight my-1">
                    <a
                      href={`/interviews/${slug}`}
                      class="underline decoration-accent hover:bg-accent"
                    >
                      {interview.data.title}
                    </a>
                  </p>
                  <p class="text-muted-foreground font-mono text-sm text-balance">
                    {interview.data.description}
                  </p>
                </div>
              </li>
            );
          })}
        </ul>
      </section>
    ) : null
  }
</Layout>
